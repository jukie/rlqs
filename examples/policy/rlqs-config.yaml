server:
  grpc_addr: ":18081"

engine:
  # Default RPS for buckets that don't match any policy
  default_rps: 100

  reporting_interval: "10s"

  # Policy-based rate limiting: first match wins
  policies:
    # API endpoints get higher limits
    - domain_pattern: "^api\\."
      bucket_key_pattern: ""
      rps: 1000
      assignment_ttl: "20s"

    # Premium users get special treatment
    - domain_pattern: ""
      bucket_key_pattern: "tier\x00premium"
      rps: 5000
      assignment_ttl: "30s"

    # Internal services get very high limits (allow all)
    - domain_pattern: "^internal\\."
      bucket_key_pattern: ""
      strategy: "allow"
      assignment_ttl: "60s"

    # Block known-bad domains entirely
    - domain_pattern: "^blocked\\."
      strategy: "deny"
      assignment_ttl: "120s"
      deny_response:
        http_status: 403
        http_body: '{"error": "access denied", "reason": "domain blocked"}'
        grpc_status_code: 7
        grpc_status_message: "domain blocked by policy"
        response_headers_to_add:
          X-RateLimit-Policy: "blocked"
          Retry-After: "3600"
